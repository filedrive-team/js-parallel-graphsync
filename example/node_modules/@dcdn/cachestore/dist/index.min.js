(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.DcdnCachestore = factory()}(typeof self !== 'undefined' ? self : this, function () {
var DcdnCachestore=(()=>{var M=Object.create;var p=Object.defineProperty;var T=Object.getOwnPropertyDescriptor;var B=Object.getOwnPropertyNames;var R=Object.getPrototypeOf,j=Object.prototype.hasOwnProperty;var w=r=>p(r,"__esModule",{value:!0});var b=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),q=(r,e)=>{w(r);for(var t in e)p(r,t,{get:e[t],enumerable:!0})},z=(r,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of B(e))!j.call(r,n)&&n!=="default"&&p(r,n,{get:()=>e[n],enumerable:!(t=T(e,n))||t.enumerable});return r},m=r=>z(w(p(r!=null?M(R(r)):{},"default",r&&r.__esModule&&"default"in r?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0})),r);var g=b((L,x)=>{"use strict";var _=async r=>{for await(let e of r);};x.exports=_});var k=b((de,O)=>{"use strict";function I(r,e){for(let t in e)Object.defineProperty(r,t,{value:e[t],enumerable:!0,configurable:!0});return r}function $(r,e,t){if(!r||typeof r=="string")throw new TypeError("Please pass an Error to err-code");t||(t={}),typeof e=="object"&&(t=e,e=""),e&&(t.code=e);try{return I(r,t)}catch(n){t.message=r.message,t.stack=r.stack;let o=function(){};return o.prototype=Object.create(Object.getPrototypeOf(r)),I(new o,t)}}O.exports=$});var V={};q(V,{Cachestore:()=>l});var d=m(g());var X=new Uint8Array(0);var v=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},A=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseDecode=n}decode(e){if(typeof e=="string")switch(e[0]){case this.prefix:return this.baseDecode(e.slice(1));default:throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`)}else throw Error("Can only multibase decode strings")}or(e){return E(this,e)}},U=class{constructor(e){this.decoders=e}or(e){return E(this,e)}decode(e){let t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},E=(r,e)=>new U({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}}),C=class{constructor(e,t,n,o){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=o,this.encoder=new v(e,t,n),this.decoder=new A(e,t,o)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},K=({name:r,prefix:e,encode:t,decode:n})=>new C(r,e,t,n);var P=(r,e,t,n)=>{let o={};for(let h=0;h<e.length;++h)o[e[h]]=h;let a=r.length;for(;r[a-1]==="=";)--a;let c=new Uint8Array(a*t/8|0),s=0,f=0,N=0;for(let h=0;h<a;++h){let y=o[r[h]];if(y===void 0)throw new SyntaxError(`Non-${n} character`);f=f<<t|y,s+=t,s>=8&&(s-=8,c[N++]=255&f>>s)}if(s>=t||255&f<<8-s)throw new SyntaxError("Unexpected end of data");return c},F=(r,e,t)=>{let n=e[e.length-1]==="=",o=(1<<t)-1,a="",c=0,s=0;for(let f=0;f<r.length;++f)for(s=s<<8|r[f],c+=8;c>t;)c-=t,a+=e[o&s>>c];if(c&&(a+=e[o&s<<t-c]),n)for(;a.length*t&7;)a+="=";return a},i=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>K({prefix:e,name:r,encode(o){return F(o,n,t)},decode(o){return P(o,n,t,r)}});var D=i({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),ne=i({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),oe=i({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),ae=i({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),se=i({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ie=i({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ce=i({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),fe=i({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),he=i({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var S=m(k());function u(r){return"/"+D.encode(r.multihash.bytes).slice(1).toUpperCase()}function Q(r){return r=r||new Error("Not Found"),(0,S.default)(r,"ERR_NOT_FOUND")}var l=class{constructor(e){this.namespace=e}async open(){this.cache=await caches.open(this.namespace)}async close(){}put(e,t,n){if(!this.cache)throw new Error("Datastore needs to be opened.");return this.cache.put(u(e),new Response(t))}async get(e,t){if(!this.cache)throw new Error("Datastore needs to be opened.");let n=await this.cache.match(u(e));if(!n)throw Q();let o=await n.arrayBuffer();return new Uint8Array(o)}async has(e,t){if(!this.cache)throw new Error("Datastore needs to be opened.");try{await this.get(e)}catch(n){if(n.code==="ERR_NOT_FOUND")return!1;throw n}return!0}async delete(e,t){if(!this.cache)throw new Error("Datastore needs to be opened.");await this.cache.delete(u(e))}async*putMany(e,t={}){for await(let{key:n,value:o}of e)await this.put(n,o,t),yield{key:n,value:o}}async*getMany(e,t={}){for await(let n of e)yield this.get(n,t)}async*deleteMany(e,t={}){for await(let n of e)await this.delete(n,t),yield n}batch(){let e=[],t=[];return{put(n,o){e.push({key:n,value:o})},delete(n){t.push(n)},commit:async n=>{await(0,d.default)(this.putMany(e,n)),e=[],await(0,d.default)(this.deleteMany(t,n)),t=[]}}}query(e,t){throw new Error("query is not implemented")}queryKeys(e,t){throw new Error("queryKeys is not implemented")}};return V;})();
return DcdnCachestore}));
